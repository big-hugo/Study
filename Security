伪装登录(用于隐藏系统和内核版本)
vim /etc/issue              本地登录提示文件
vim /etc/issue.net          远程登录提示文件

文件系统安全
chkconfig  httpd  off/on    RHEL6系统服务操作命令
systemctl  enable/disable  httpd    RHEL7系统服务操作命令
锁定/解锁保护文件(root用户同样受到限制)
EXT3/EXT4的文件属性控制  属性i:不可变  属性a:仅可追加
chatte  +a   文件     设置对文件属性(+-=可用)
lsattr [-l]  文件     查看文件属性

selinux
三大保护策略:安全上下文,布尔值,端口
vim /etc/sysconfig/selinux    主配置文件
SELINUX=disabled              定义默认启用模式
SELINUXTYPE=targeted          定义默认工作模式
getenforce           查看selinux是否开启
sestatus             查看selinux状态
setenforce   1/0     开启/关闭selinux(临时)
安全上下文
移动的文件,原有安全上下文不变;新建/复制的文件,自动继承目标位置的上下文
属性构成   system_u:object_r:admin_home_t:s0      用户:角色:访问类型:选项...
ls -lZ  文件          查看安全上下文
ls -ldZ /etc         查看安全上下文
ps -aux -Z | grep 进程名       查看安全上下文
chcon -t  访问类型  [-R]  文件  修改文件上下文访问类型(-R递归)
restorecon  [-R]  文件         恢复所在位置默认上下文属性(-R递归)  
touch  /.autorelabel          创建该文件,下次重启系统全部恢复上下文属性
布尔值(功能开关)
getsebool -a          查看所有配置项布尔值
setsebool -P  配置项名称 on/off      开/关布尔值

MD5数值校验
根据输入的文件生成不同的哈希值,可通过对比哈希值检测文件是否有变化
md5sum  文件            生成哈希值

GPG加/解密工具
gpg --version           查看软件版本信息
gpg对称加密与解密
gpg -c 文件             设置密码
file  文件*              查看加密后文件(加密后会生成文件.gpg)
gpg -d  加密后文件  >  输出到文档      解密文档(不同用户需要输入密码)
gpg非对称加密与解密
(mv /dev/random /dev/random.bak    如果启动不了或过慢
ln -s /dev/urandom /dev/random    执行这两部操作进行内存调整)
gpg --gen-key           创建秘钥对(秘钥对存放在~/.gnupg/)
gpg --list-keys         查看秘钥信息
gpg --export -a  >  用户名.pub       生成公钥文件(发送给目标用户)
gpg --import 用户名.pub              导入公钥文件
gpg -e -r 公钥用户名   文件           用公钥给文件加密(生成文件.gpg)
gpg -d  加密文件         解密文档(输入公钥设置的密码)
gpg数字签名与验证签名(私钥文件签名 公钥文件验证签名)
gpg -b 文件              给文件作签名(生成文件.sig)
gpg --import 用户名.pub              导入公钥文件
gpg --verify  文件       检验签名(没修改会提示完好签名)

AIDE入侵检测系统
yum -y install aide     安装软件包
vim /etc/aide.conf      主配置文件 
3 @@define DBDIR /var/lib/aide            数据库目录
4 @@define LOGDIR /var/log/aide           日志目录
7 database=file:@@{DBDIR}/aide.db.gz      数据库文件名
54 FIPSR = p+i+n+u+g+s+m+c+acl+selinux+xattrs+sha256   检测的策略名=检测项目
98 /root/    FIPSR     用FIPSR检测策略检测root目录
aide --init             初始化检测(记录当前系统检测情况)
mv  /var/lib/aide/aide.db.new.gz  /var/lib/aide/aide.db.gz  数据备份(一般备份到移动设备)
aide --check            检测对比信息(与初始化检测的文件作对比)

日志管理
由系统服务rsyslog统一管理和记录,日志消息等级0~7,数值越小越紧急
/var/log/messages     记录内核,各种服务           /var/log/maillog      记录邮件收发
/var/log/dmesg        记录系统启动过程            /var/log/secure       记录访问限制相关
/var/log/cron         记录cron计划任务
user      查看已登录用户信息
who       查看已登录用户信息
w         查看已登录用户信息
last      查看登录成功用户记录
lastb     查看登录失败用户记录

扫描与抓包
主流扫描软件:Scan主动监测,Sniff被动监听/嗅探,Capture数据包捕获(抓包),NMAP强大的网络探测利器工具
NMAP扫描软件
用法格式:   nmap  [扫描类型]  [选项]  扫描目标...
扫描类型:  -sS TCP-SYN扫描(半开,DDOS攻击原理)    -sT  TCP连接扫描(全开,默认)   -sU  UDP扫描   -sP  ICMP扫描  -A 目标系统全面解析
选项:     -p 扫描指定端口     -n 不执行dns扫描(速度更快)
yum -y install nmap       安装软件
nmap -p 21-80   192.168.4.0/24     扫描4网段的主机指定端口
nmap -n 192.168.4.0/24    扫描4网段有多少主机开启
nmap www.baidu.com        扫描百度的服务端口
tcpdump抓包命令
yum -y install tcpdump    安装软件
用法格式: tcpdump   [选项]   [过滤条件]
选项: -i 指定监控的网络接口  -A 转为ACSII码方便阅读  -w 将数据包信息保存到指定文件  -c 定义抓包个数  -r 从指定文件读取数据包信息
过滤条件: 类型host net port portrange  方向src dst  协议tcp udp ip wlan arp  多个条件组合and or not
tcpdump -i  网卡名称       指定网卡抓包
tcpdump -c 2 -w x.cap     抓两个包保存到x.cap文件
tcpdump -r x.cap          读取x.cap文件
tcpdump -i eth0 -A tcp port 22 and host 172.121.213.105 or host 172.121.213.111     查看是否有来自该IP的连接
tcpdump -A dst host 192.168.4.5 and tcp port 110          按条件抓取POP3的数据包(可查看账号密码)
tcpdump  -A  -w ftp.cap host 192.168.4.254 and port 21    把来自254接收端口21的包信息保存到ftp.cap
tcpdump  -A -r ftp.cap | egrep '(USER|PASS)'    过滤抓到包的用户信息
WireShark图形环境抓包软件
yum -y install wireshark wireshark-gnome    安装软件包
wireshark       运行软件

系统审计
基于事先配置好的规则生成日志,用于发现并记录违反安全策略的人及其对应的行为
yum  -y install  audit              安装软件包    
systemctl start auditd.service      启动服务
systemctl enable auditd.service     设定开机自启
vim  /etc/audit/auditd.conf         主配置文件
log_file = /var/log/audit/audit.log       日志文件
auditctl -s                         查询审计状态
auditctl -l                         查看审计规则
auditctl -D                         删除所有规则
auditctl -w  文档  -p [r,w,x,a]  -k  规则名          定义临时审计规则
auditctl -w  /etc/passwd  -p wa -k  passwd_change  定义临时审计规则(审计/etc/passwd是否被写入,属性是否修改,规则名为passwd_change)
auditctl -w /etc/selinux/ -p wa -k selinux_chage   定义临时审计规则(审计/etc/selinux是否被写入,属性是否修改,规则名为selinux_change)
auditctl -w /usr/sbin/fdisk -p x -k fdisk_parition
vim /etc/audit/rules.d/audit.rules        定义永久审计规则
-w /etc/passwd -p wa -k passwd_change     追加到配置文件
-w /etc/selinux -p wa -k selinux_chage    追加到配置文件
ausearch -k 规则名 [-i]               查看规则日志(success事件是否成功,auid是审核用户的id,comm执行的指令,exe实际程序路径)
aureport                             审计信息报表

服务安全
nginx服务安全
防止别人进入网站目录下查看服务器的网页
./configure --without-http_autoindex_modul && make && make install    关闭模块
隐藏nginx服务版本
curl -I ip或域名         查看网页服务器信息(可显示出版本)
vim /nginx-1.12.2/src/http/ngx_http_header_filter_module.c    修改源文件  
50 static u_char ngx_http_server_full_string[] = "Server: 自定义" CRLF;   修改版本信息
./configure && make && make install     重新编译安装
限制并发(1台客户端的并发连接数量),降低DDos攻击风险
vim /usr/local/nginx/conf/nginx.conf    修改配置文件
http {
limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;    定义一个10m的储存空间,每秒处理一个请求
server {
 limit_req zone=one burst=5;              储存空间储存5个请求
 ab -c 客户数 -n 请求数 http://127.0.0.1/       并发量测试
拒绝非法请求
vim /usr/local/nginx/conf/nginx.conf    修改配置文件
server{
    if($require_method !~ ^(GET|POST)$){        匹配GET|POST请求
      return 444;                        返回444 
curl -i -X HEAD http://127.0.0.1/        测试配置(空返回值)
数据库服务安全
数据库初始化安全脚本
mysql_secure_installation                命令行输入启动安全脚本回车
Change the password for root ?           需要修改root密码?
Remove anonymous users?                  删除匿名账户?
Disallow root login remotely?            允许root远程登录?
Remove test database and access to it?   删除测试库?
Reload privilege tables now?             刷新权限表?
抓包验证数据库服务器能否被访问
tcpdump -w log -i eth0 src or dst port 3306
删除记录历史文件
history -c    清除当前终端历史命令
rm  -rf  ~/.bash_history      清除系统所有历史命令
rm  -rf  ~/.mysql_history     清除数据库所有历史命令
tomcat服务安全
隐藏软件版本
 curl -I http://192.168.4.50:8080         查看网页服务器版本
 yum -y install java-1.8.0-openjdk-devel  安装jar
 jar -xf /tomcat/org/apache/catalina.jar  解压包
 vim lib/org/apache/catalina/util/ServerInfo.properties   修改源文件
 server.info=自定义      修改版本信息
 bin/shutdown.sh        关闭服务
 bin/startup.sh         开启服务
健全运行
useradd tomcat            系统添加用户
chown -R tomcat /usr/local/tomcat       授权
su -  -c "/usr/local/tomcat/bin/startup.sh" tomcat        以tomcat用户运行启动命令

linux创建补丁文件
diff逐行比较
diff [选项]  文件1 文件2              文档对比
-u 输出统一内容的头部信息(打补丁使用)
-r 递归对比目录中的所有资源(可以对比目录)
-a 所有文件视为文本(包括二进制程序)
-N 无文件视为空文件(空文件怎么变成第二个文件)
diff [选项]  文件1 文件2  >  补丁文件   生成补丁文件
patch打补丁
yum -y install patch        安装软件
patch -p数字 < 补丁文件       给文件打补丁(数字代表删除补丁文件中多少层路径前缀,0代表在补丁文件所在路径)
patch -RE < 补丁文件         反向修复(撤回)























